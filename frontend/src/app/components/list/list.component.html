<p-accordion [value]="categoryList" [multiple]="true" class="accordion">
  @for (category of categoryList; track category) {
    <p-accordion-panel [value]="category">
      <p-accordion-header [class]="'panel-category-' + activePage()">
        {{ category }}
      </p-accordion-header>
      <p-accordion-content>
        <p-table [value]="products()">
          <ng-template #body let-product of products>
            @if (product.category === category) {
              <tr class="tr-list">
                <td class="td-small-item">
                  @if (activePage() === "cart") {
                    <p-checkbox
                      [(ngModel)]="product.checked"
                      (ngModelChange)="updateCartQuantity(product)"
                      [binary]="true"
                    />
                  } @else {
                    <p-checkbox
                      [(ngModel)]="product.isCheck"
                      (ngModelChange)="onProductCheck(product)"
                      [binary]="true"
                    />
                  }
                </td>
                <td class="td-designation">
                  @if (activePage() === "cart" && product.checked) {
                    <del>{{ product.name }}</del>
                  } @else {
                    {{ product.name }}
                  }
                </td>
                <p-toast
                  position="top-center"
                  [breakpoints]="{
                    '920px': { width: '90%' },
                  }"
                />
                @if (activePage() !== "cart") {
                  @if (activePage() !== "favorit") {
                    <td class="btn-change-stock">
                      <p-inputnumber
                        class="button-container"
                        [(ngModel)]="product.quantity"
                        [showButtons]="true"
                        buttonLayout="horizontal"
                        spinnerMode="horizontal"
                        inputId="horizontal"
                        [inputStyle]="{ width: '2rem' }"
                        (ngModelChange)="updateStockQuantity(product)"
                      >
                        <ng-template #incrementbuttonicon>
                          <span class="pi pi-plus"></span>
                        </ng-template>
                        <ng-template #decrementbuttonicon>
                          <span class="pi pi-minus"></span>
                        </ng-template>
                      </p-inputnumber>
                    </td>
                    <td class="td-small-item">{{ product.unit }}</td>
                  }
                  <td class="td-small-item">
                    <button
                      (click)="toggleFavorite(product.productId)"
                      class="btn-favorit"
                    >
                      @if (product.favorite) {
                        <i id="fav" class="pi pi-heart-fill"></i>
                      } @else {
                        <i id="fav" class="pi pi-heart"></i>
                      }
                    </button>
                  </td>
                } @else {
                  <td class="btn-change-stock">
                    <p-inputnumber
                      class="button-container"
                      [(ngModel)]="product.quantity"
                      [showButtons]="true"
                      buttonLayout="horizontal"
                      spinnerMode="horizontal"
                      inputId="horizontal"
                      [inputStyle]="{ width: '2rem' }"
                      (ngModelChange)="updateCartQuantity(product)"
                    >
                      <ng-template #incrementbuttonicon>
                        <span class="pi pi-plus"></span>
                      </ng-template>
                      <ng-template #decrementbuttonicon>
                        <span class="pi pi-minus"></span>
                      </ng-template>
                    </p-inputnumber>
                  </td>
                }
              </tr>
            }
          </ng-template>
        </p-table>
      </p-accordion-content>
    </p-accordion-panel>
  }
</p-accordion>
